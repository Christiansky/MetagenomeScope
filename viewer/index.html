<!doctype html>
<!--
    Copyright (C) 2017 Marcus Fedarko, Jay Ghurye, Todd Treangen, Mihai Pop
    Authored by Marcus Fedarko
    
    This file is part of MetagenomeScope.
    
    MetagenomeScope is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
    
    MetagenomeScope is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
    
    You should have received a copy of the GNU General Public License
    along with MetagenomeScope.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="shortcut icon" href="bubble.ico" />
        <meta name="viewport"
            content="width=device-width,initial-scale=1,user-scalable=no" />
        <meta name="description"
            content="Web application for the hierarchical visualization of scaffold and assembly graphs." />
        <title>MetagenomeScope Viewer</title>
        <!-- Load external libraries -->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/viewer_style.css">
        <link rel="stylesheet" href="css/bootstrap-colorpicker.min.css">
        <script src="js/jquery-3.2.1.min.js"></script>
        <script src='js/cytoscape.min.js'></script>
        <!-- NOTE if including Cytoscape.js layout plugins for testing, those
            can go here -->
        <script src='js/sql.js'></script>
        <script src='js/xdot2cy.js'></script>
        <script src='js/bootstrap.min.js'></script>
        <script src='js/bootstrap-colorpicker.min.js'></script>
        <script src='js/d3.v4.min.js'></script>
        <!-- Initialize some event bindings for the application -->
        <script>
            $(function() {
                $(window).on("beforeunload", closeDB);
                $("input[name=rotationRadio]").on("change", changeRotation);
                $("#hideEdgesCheckbox").on("change", toggleHEV);
                $("#useTexturesCheckbox").on("change", toggleUTV);
                $("#settingsDialog").on("hide.bs.modal", function(e) {
                    $(".colorpicker-component").colorpicker("hide");
                });
                // If we add any tooltips, use this line to initialize them
                //$("[data-toggle='tooltip']").tooltip();
            });
        </script>
        <!-- Initialize colorpickers -->
        <script>
            $(function() {
                $(".colorpicker-component").colorpicker({format: 'hex'});
                $("#mincncp").on("changeColor", function(e) {
                    redrawGradientPreview(e.color.toHex(), -1);
                });
                $("#maxcncp").on("changeColor", function(e) {
                    redrawGradientPreview(e.color.toHex(), 1);
                });
            });
        </script>
    </head>
    <body>
        <!-- Invisible <a> used for downloading data URIs for various purposes
            (e.g. path exporting, color settings export). By adjusting the
            download parameter of this tag, we can provide the user with a
            suggested filename for the file to be downloaded (instead of just
            opening the data URI using window.open()).
        -->
        <a class="notviewable" id="downloadHelper"></a>
        <!-- Absolutely positioned tools -->
        <div id="controlsToggler" onclick="toggleControls();" class="btn">
           <span class="glyphicon glyphicon-menu-hamburger"></span>
        </div>

        <!-- NOTE: For all Bootstrap buttons, we need to do two "layers"
             of disabling. Adding the disabled class to a button makes
             Bootstrap style the button to look disabled, but the button
             will still be usable. Adding the disabled="disabled" attribute
             makes the button actually disabled (i.e. not usable).
        
             To handle this properly, we use the enableButton and
             disableButton functions (defined in xdot2cy.js) to ensure
             buttons are always properly disabled/enabled.
        -->
        <button class='btn btn-default btn-sm disabled'
            onclick='exportGraphView();' id="floatingExportButton"
            disabled="disabled">
            <span class="glyphicon glyphicon-camera"></span>
        </button>

        <button class='btn btn-default btn-sm disabled'
            onclick='fitGraph(false)' id="fitButton" disabled="disabled">
            <span class="glyphicon glyphicon-resize-full"></span>
        </button>

        <button class='btn btn-default btn-sm disabled'
            onclick='fitGraph(true)' id="fitSelectedButton"
            disabled="disabled">
            <span class="glyphicon glyphicon-resize-small"></span>
        </button>

        <div id="controls">
            <!-- TODO replace these headers with a nicer-looking system? -->
            <h4 style="margin-top: 26px;">File Selection</h4>
            <p>
            <button class='btn btn-default btn-sm' id="xmlFileselectButton"
                onclick="openFileSelectDialog();">
                <span class="glyphicon glyphicon-repeat"
                    aria-hidden="true"></span> &nbsp; Demo .db
            </button>
            <button class='btn btn-default btn-sm' id="fileselectButton"
                onclick="$('#fileselector').click();">
                <span class="glyphicon glyphicon-folder-open"
                    aria-hidden="true"></span> &nbsp; Choose .db file
            </button>
            <!-- For some reason, styling this with a "hiddenElement" CSS class
                doesn't work; I suspect it's due to the way browsers handle
                styling of file inputs. Anyway, this should work fine. -->
    	    <input type='file' id='fileselector'
                onchange='loadgraphfile();' style="display: none"/>

            <button class='btn btn-default btn-sm disabled'
                disabled="disabled"
                onclick='displayInfo();' id="infoButton">
                <span class="glyphicon glyphicon-info-sign"
                    aria-hidden="true"></span> &nbsp; Assembly info
            </button>
            <button class='btn btn-default btn-sm' id='settingsButton'
                onclick='displaySettings();'>
                <span class="glyphicon glyphicon-cog"></span> &nbsp;
                <span>Settings</span>
            </button>
            </p>
            <div class="progress">
                <div class="progress-bar notransitions" role="progressbar"
                     aria-valuenow="0" aria-valuemin="0"
                     aria-valuemax="100" style="width: 100%;">
                    <span class="sr-only"></span>
                </div>
            </div>
            <div id='textStatus'>&nbsp;</div>
            <hr />

            <div id="connectedComponentControls">
                <h4>Standard Mode</h4>
    
                <p>
                    <div class='input-group input-group-sm'>
                        <span class='input-group-btn'>
                            <button class='btn btn-default disabled'
                                disabled="disabled"
                                onclick='decrCompRank("componentselector");'
                                type="button" id="decrCompRankButton">
                                <span class="glyphicon glyphicon-minus"
                                    aria-hidden="true"
                                    aria-label="Decrement component size rank by 1">
                                </span>
                            </button>
                        </span>
                        <input type='text' class='form-control'
                            id="componentselector" value="1" min="1"
                            disabled="disabled">
                        <span class='input-group-btn'>
                            <button class='btn btn-default disabled'
                                disabled="disabled"
                                onclick='incrCompRank("componentselector");'
                                type="button" id="incrCompRankButton">
                                <span class="glyphicon glyphicon-plus"
                                    aria-hidden="true"
                                    aria-label="Increment component size rank by 1">
                                </span>
                            </button>
                        </span>
                    </div>
                    <button class='btn btn-default btn-sm disabled'
                        disabled="disabled" onclick='startDrawComponent("double");'
                        type="button" id="drawButton">
                        <span class="glyphicon glyphicon-pencil"
                            aria-hidden="true"></span> &nbsp;
                            Draw connected component
                    </button>
                </p>
                <hr />
            </div>
            <div id="spqrConnectedComponentControls">
                <h4>SPQR Decomposition Mode</h4>
    
                <p>
                    <div class='input-group input-group-sm'>
                        <span class='input-group-btn'>
                            <button class='btn btn-default disabled'
                                disabled="disabled"
                               onclick='decrCompRank("SPQRcomponentselector");'
                                type="button" id="decrSPQRCompRankButton">
                                <span class="glyphicon glyphicon-minus"
                                    aria-hidden="true"
                                    aria-label=
                                        "Decrement component size rank by 1">
                                </span>
                            </button>
                        </span>
                        <input type='text' class='form-control'
                            id="SPQRcomponentselector" value="1" min="1"
                            disabled="disabled">
                        <span class='input-group-btn'>
                            <button class='btn btn-default disabled'
                                disabled="disabled"
                               onclick='incrCompRank("SPQRcomponentselector");'
                                type="button" id="incrSPQRCompRankButton">
                                <span class="glyphicon glyphicon-plus"
                                    aria-hidden="true"
                                    aria-label=
                                        "Increment component size rank by 1">
                                </span>
                            </button>
                        </span>
                    </div>
                    <button class='btn btn-default btn-sm disabled'
                        disabled="disabled"
                        onclick='startDrawComponent("SPQR");' type="button"
                        id="drawSPQRButton">
                        <span class="glyphicon glyphicon-pencil"
                            aria-hidden="true"></span> &nbsp;
                            Draw connected component
                    </button>
                    <div class="btn-group" data-toggle="buttons"
                        id="decompositionOptionButtonGroup"
                        aria-label="SPQR Decomposition Options">
                        <button class="btn btn-default active disabled btn-sm"
                            value="implicit" id="implicitSPQROption"
                            disabled="disabled">
                            <input type="radio" name="spqrDecomposition"
                                id="implicitSPQRtrees"
                                autocomplete="off">Implicit
                        </button>
                        <button class="btn btn-default disabled btn-sm"
                            value="explicit" id="explicitSPQROption"
                            disabled="disabled">
                            <input type="radio" name="spqrDecomposition"
                                id="explicitSPQRtrees"
                                autocomplete="off">Explicit
                        </button>
                    </div>
                </p>

                <hr /> 
            </div>
            <div id="selectedElementControls">
                <h4>Selected Elements</h4>
                <p>
    
                <!-- Selected node info -->
                <div class="selectedEleHeader"
                        onclick="toggleEleInfo('node');">
                    Nodes <span class="badge" id="selectedNodeBadge">0</span>
                    <span class="glyphicon glyphicon-triangle-right opener"
                        id="nodeOpener"></span>
                </div>
                <div id="nodeInfo" class="notviewable">
                    <table border="2" id="nodeInfoTable"
                            class="eleInfoTable">
                        <tr>
                            <th colspan='5' id="nodeTH">
                                Selected Node Information</th>
                        </tr>
                        <tr>
                            <th>ID</th>
                            <th id="labelCol">Label</th>
                            <th>Length</th>
                            <th id="depthCol">Depth</th>
                            <th id="gcContentCol">GC Content</th>
                        </tr>
                    </table>
                </div>
                <!-- Selected edge info -->
                <div class="selectedEleHeader"
                        onclick="toggleEleInfo('edge');">
                    Edges <span class="badge" id="selectedEdgeBadge">0</span>
                    <span class="glyphicon glyphicon-triangle-right opener"
                        id="edgeOpener"></span>
                </div>
                <div id="edgeInfo" class="notviewable">
                    <table border="2" id="edgeInfoTable"
                        class="eleInfoTable">
                    <tr>
                        <th colspan='6' id="edgeTH">Selected Edge Information
                        </th>
                    </tr>
                    <tr>
                        <th>Src ID</th>
                        <th>Tgt ID</th>
                        <th id="multiplicityCol">Multiplicity</th>
                        <th id="orientationCol">Orient</th>
                        <th id="meanCol">Mean</th>
                        <th id="stdevCol">Std. Dev</th>
                    </tr>
                    </table>
                </div>
                <!-- Selected cluster info -->
                <div class="selectedEleHeader"
                        onclick="toggleEleInfo('cluster');">
                    Clusters
                        <span class="badge" id="selectedClusterBadge">0</span>
                    <span class="glyphicon glyphicon-triangle-right opener"
                        id="clusterOpener"></span>
                </div>
                <div id="clusterInfo" class="notviewable">
                    <table border="2" id="clusterInfoTable"
                        class="eleInfoTable">
                    <tr>
                        <th colspan='2'>Selected Cluster Information</th>
                    </tr>
                    <tr>
                        <th>Cluster Type</th>
                        <th>Node Count</th>
                    </tr>
                    </table>
                </div>

                </p>
                <hr /> 
            </div>
            <div id="searchForElementsControls">
                <h4>Search for Elements</h4>
                <div class='input-group input-group-sm'>
                    <input type='text' class='form-control'
                        placeholder="Element ID/Node Label(s)" id="searchInput"
                        disabled="disabled"
                        onkeypress="searchWithEnter(event);">
                    <span class='input-group-btn'>
                        <button class='btn btn-default disabled'
                            disabled="disabled"
                            onclick='searchForEles();' type="button"
                            id="searchButton" aria-label="Search">
                            <span class="glyphicon glyphicon-search"
                                aria-hidden="true"></span>
                        </button>
                    </span>
                </div>
                <hr />
            </div>
            <div id="displayOptionsControls">
            <h4>Display Options</h4>
                <p id="collapseButtonControls">
                <!-- Value of this button will be toggled as all nodes in graph
                     are collapsed/uncollapsed -->
                <button class='btn btn-default btn-sm disabled'
                    disabled="disabled"
                    id='collapseButton' onclick='startCollapseAll();'>
                    <span id="collapseButtonIcon"
                        class="glyphicon glyphicon-minus-sign"></span> &nbsp;
                    <span id="collapseButtonText">Collapse all node groups
                    </span>
                </button>
                </p>

                <p>
                <button class='btn btn-default btn-sm disabled'
                    disabled="disabled" id='reduceEdgesButton'
                    onclick='reduceEdgesToStraightLines(true);'>
                    <span class="glyphicon glyphicon-sort"></span> &nbsp;
                    <span>Reduce all edges to straight lines</span>
                </button>
                </p>

                <p>
                <button class='btn btn-default btn-sm disabled'
                    disabled="disabled" id='filterEdgesButton'
                    onclick='openEdgeFilteringDialog();'>
                    <span class="glyphicon glyphicon-filter"></span> &nbsp;
                    <span>Filter edges by weight</span>
                </button>
                </p>

                <hr />
            </div>
            <div id="nodeColorizationControls">
                <h4>Node Colorization</h4>
                <p>
                <div class="btn-group" data-toggle="buttons"
                    id="nodeColorizationButtonGroup"
                    aria-label="Node colorization selector">
                    <button class="btn btn-default active disabled btn-sm"
                        value="noncolorized" id="noNodeColorizationOption"
                        disabled="disabled">
                        <input type="radio" name="nodeColorization"
                            id="noNodeColorization" autocomplete="off">None
                    </button>
                    <button class="btn btn-default disabled btn-sm"
                            value="gccolorized" id="gcNodeColorizationOption"
                            disabled="disabled">
                        <input type="radio" name="nodeColorization"
                            id="gcNodeColorization"
                            autocomplete="off">GC Content
                    </button>
                </div>

                <button class='btn btn-default btn-sm disabled'
                    disabled="disabled" id='changeNodeColorizationButton'
                    onclick='startChangeNodeColorization();'><span
                        class="glyphicon glyphicon-check"></span> &nbsp; Apply
                </button>
                </p>

                <hr />
            </div>
            <div id="viewScaffoldsControls">
                <h4>View Scaffolds</h4>

                <button class='btn btn-default btn-sm disabled'
                    id="scaffoldFileselectButton" disabled="disabled"
                    onclick="$('#scaffoldFileSelector').click();">
                    <span class="glyphicon glyphicon-folder-open"
                        aria-hidden="true"></span> &nbsp; Choose AGP file
                </button>
    	        <input type='file' id='scaffoldFileSelector'
                    onchange='beginLoadAGPfile();' style="display: none"/>
                
                <p id="agpLoadedFileName" class="notviewable monospace"></p>
                <p id="scaffoldInfoHeader" class="notviewable"></p>
                <p id="scaffoldCycler" class="notviewable nonselectable">
                    <span class="glyphicon glyphicon-triangle-left cyclerBtn"
                          onclick="cycleScaffoldsLeft();">
                    </span>
                    <button class='btn btn-default btn-sm'
                        id="drawScaffoldButton" onclick="highlightScaffold();">
                    </button>
                    <span class="glyphicon glyphicon-triangle-right cyclerBtn"
                          onclick="cycleScaffoldsRight();">
                    </span>
                </p>
                <hr />
            </div>
            <div id="assemblyFinishingControls">
                <h4>Assembly Finishing</h4>

                <p>
                    <button class='btn btn-success btn-sm disabled'
                        id="startFinishingButton" disabled="disabled"
                        onclick="startFinishing();">
                        <span class="glyphicon glyphicon-play"
                            aria-hidden="true"></span> &nbsp; Start
                    </button>

                    <button class='btn btn-danger btn-sm disabled'
                        id="endFinishingButton" disabled="disabled"
                        onclick="endFinishing();">
                        <span class="glyphicon glyphicon-stop"
                            aria-hidden="true"></span> &nbsp; End
                    </button>
                </p>

                <p>
                    <div class="btn-group" data-toggle="buttons"
                        id="pathExportButtonGroup"
                        aria-label="Path export type (AGP vs. CSV) selector">
                        <button class="btn btn-info active disabled btn-sm"
                            value="AGP" id="agpOption" disabled="disabled">
                            <input type="radio" name="pathExportTypeRadio"
                                checked="checked" autocomplete="off">AGP
                        </button>
                        <button class="btn btn-info disabled btn-sm"
                            value="CSV" id="csvOption" disabled="disabled">
                            <input type="radio" name="pathExportTypeRadio"
                                autocomplete="off">CSV
                        </button>
                    </div>

                    <button class='btn btn-info btn-sm disabled'
                        id="exportPathButton" disabled="disabled"
                        onclick="exportPath();">
                        <span class="glyphicon glyphicon-download-alt"
                            aria-hidden="true"></span> &nbsp; Export Path
                    </button>
                </p>

                <p id="assembledNodes"></p>

                <hr />
            </div>
            <div id="exportGraphViewControls">
            <h4>Export Graph View</h4>
                <p>
                <div class="btn-group" data-toggle="buttons"
                    id="imgTypeButtonGroup"
                    aria-label="Image type (PNG vs. JPG) selector">
                    <button class="btn btn-default active disabled btn-sm"
                        value="PNG" id="pngOption" disabled="disabled">
                        <input type="radio" name="imgTypeRadio"
                            checked="checked" autocomplete="off">PNG
                    </button>
                    <button class="btn btn-default disabled btn-sm" value="JPG"
                        id="jpgOption" disabled="disabled">
                        <input type="radio" name="imgTypeRadio"
                            autocomplete="off">JPG
                    </button>
                </div>

                <button class='btn btn-default btn-sm disabled'
                    disabled="disabled"
                    id='exportImageButton' onclick='exportGraphView();'>
                    <span class="glyphicon glyphicon-camera"></span> &nbsp;
                    Export
                </button>
                </p>
            </div>
            <div id="testLayoutsControls">
                <!-- We include the <hr /> here because the testLayoutsControls
                    are optional (may or may not be viewable), but the
                    performanceOptionsControls are always viewable.
                -->
                <hr />
                <h4>Test Layouts</h4>
                <p>
                See <a class="actuallyalink" target="_blank"
                href="http://js.cytoscape.org/#layouts">here</a> for a
                list of predefined layouts.
                <div class='input-group input-group-sm'>
                    <input type='text' class='form-control'
                        placeholder="Layout name" id="layoutInput"
                        disabled="disabled"
                        onkeypress="layoutWithEnter(event);">
                    <span class='input-group-btn'>
                        <button class='btn btn-default disabled'
                            disabled="disabled" onclick='testLayout();'
                            type="button" id="layoutButton"
                            aria-label="Layout">
                            <span class="glyphicon glyphicon-arrow-right"
                                aria-hidden="true"></span>
                        </button>
                    </span>
                </div>
                </p>
            </div>
        </div> <!-- end controls div -->
        <div id="cy" class="nosubsume"></div> <!--container for Cytoscape.js-->
        <!-- XHR .db loader dialog -->
        <div class="modal fade" role="dialog" id='fsDialog'>
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close dialog">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title">
                            Select a demo assembly file
                        </h4>
                    </div> <!-- end modal-header div -->
                    <div class="modal-body">
                        <!-- modal-body stuff -->
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs" id="mh51.db"
                                    checked="checked">
                                SRS011111: <code>megahit_51</code>
                                (GML, 6,246 contigs, 4,181 edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs" id="mh516171.db">
                                SRS011111: <code>megahit_51_61_71</code>
                                (GML, 5,590 contigs, 4,649 edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs"
                                    id="metacompass.db">
                                SRS011111: <code>metacompass</code>
                                (GML, 5,254 contigs, 5,876 edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs" id="official.db">
                                SRS011111: <code>official</code>
                                (GML, 3,317 contigs, 5,510 edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs" id="shakya.db">
                                64-genome bacterial/archaeal metagenome from
                                <a target="_blank"
                                    href="http://www.ncbi.nlm.nih.gov/pubmed/23387867">
                                    <em>Shakya et al.</em> 2013</a>
                                (GML, 21,950 contigs, 23,501 edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs"
                                    id="shakya_new.db">
                                <a target="_blank"
                                    href="http://www.ncbi.nlm.nih.gov/pubmed/23387867">
                                <em>Shakya et al.</em></a> metagenome,
                                simplified (GML, 379 contigs, 229 edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs"
                                    id="biofilm_judson.db">
                                Ship Hull Biofilm graph 1
                                (GML, 28,107 contigs, 23,405 edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs"
                                    id="biofilm_judson2.db">
                                Ship Hull Biofilm graph 2
                                (GML, 1,839 contigs, 530 edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs"
                                    id="small_ecoli.db">
                                E. coli (GML, 168 contigs, 478 edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs"
                                    id="marygoldtest.db">
                                <a target="_blank"
                                    href="https://www.ncbi.nlm.nih.gov/pubmed/24058058">
                                    MaryGold paper</a>
                                Figure 2 graph (GML, 12 contigs, 16 edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs" id="ecoli.db">
                                E. coli, included with <a target="_blank"
                                    href="http://rrwick.github.io/Bandage">
                                    Bandage</a>
                                (LastGraph, 279 positive contigs, 332 positive
                                edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs"
                                    id="sample_LastGraph.db">
                                sample_LastGraph, included with
                                    <a target="_blank"
                                    href="http://rrwick.github.io/Bandage">
                                    Bandage</a>
                                (LastGraph, 61 positive contigs, 82 positive
                                edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs"
                                    id="sample_gfa.db">
                                sample.gfa from <a target="_blank"
                                   href="https://github.com/sjackman/assembly-graph/blob/master/sample.gfa">Shaun Jackman</a>
                                    (GFA, 6 positive contigs, 4 positive edges)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio" name="fs" id="loop_gfa.db">
                                loop.gfa from <a target="_blank"
                                   href="https://github.com/sjackman/assembly-graph/blob/master/loop.gfa">Shaun Jackman</a>
                                    (GFA, 4 positive contigs, 4 positive edges)
                            </label>
                        </div>
                    </div> <!-- end modal-body div -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default"
                            data-dismiss="modal">Close
                        </button>
                        <button type="button" class="btn btn-primary"
                            id="loadDBbutton" onclick="loadajaxDB();">
                            Load selected file
                        </button>
                    </div>
                </div> <!-- end modal-content div -->
            </div> <!-- end modal-dialog div -->
        </div> <!-- end modal div -->
        <!-- Settings dialog -->
        <div class="modal fade" tabindex="-1" role="dialog"
                                              id="settingsDialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close dialog">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title">Settings</h4>
                    </div> <!-- end modal-header div -->
                    <div class="modal-body">
                        <p>Changes to these parameters will take effect before
                        drawing a graph.</p>
                        <div>
                            <ul class="nav nav-tabs" role="tablist">
                                <li role="presentation" class="active">
                                    <a href="#animationtab"
                                    aria-controls="animation"
                                    role="tab" data-toggle="tab">
                                    Animation</a>
                                </li>
                                <li role="presentation">
                                    <a href="#performancetab"
                                    aria-controls="performance"
                                    role="tab" data-toggle="tab">
                                    Performance</a>
                                </li>
                                <li role="presentation">
                                    <a href="#colortab"
                                    aria-controls="colors"
                                    role="tab" data-toggle="tab">
                                    Colors</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div role="tabpanel" class="tab-pane active"
                                    id="animationtab">
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" checked
                                            id="useProgressBarStripesCheckbox">
                                            Show moving stripes on
                                            indeterminate progress bars
                                        </label>
                                    </div>
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" checked
                                            id="useDrawingStatusTextCheckbox">
                                            Update status text while drawing
                                            connected components (for graphs
                                            that take a short amount of time to
                                            draw, this text might change
                                            relatively quickly)
                                        </label>
                                    </div>
                                </div> <!-- end animationtab -->
                                <div role="tabpanel" class="tab-pane"
                                    id="performancetab">
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox"
                                                disabled="disabled"
                                                id="hideEdgesCheckbox">
                                            Hide edges during movement
                                        </label>
                                    </div>
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox"
                                                disabled="disabled"
                                                id="useTexturesCheckbox">
                                            Use a texture during movement
                                        </label>
                                    </div>
                                </div> <!-- end performancetab -->
                                <div role="tabpanel" class="tab-pane"
                                    id="colortab">
                                    <!-- the margin-top:10px matches the
                                        default checkbox formatting in
                                        bootstrap, making switching between
                                        tabs look smooth.
                                    -->
                                    <div class="container-fluid"
                                        style="margin-top:10px;">
                                    <div class="row">
                                    <div class="col-lg-6">
                                    <button
                                        class="btn btn-default btn-sm csbtn"
                                        id="importColorSettingsButton"
                                        onclick="$('#colorSettingsFS').click();">
                                        <span class="glyphicon glyphicon-folder-open"
                                          aria-hidden="true"></span> &nbsp;
                                          Import color settings file
                                    </button>
                                    <input type='file' id='colorSettingsFS'
                                          onchange="importColorSettings();"
                                          style="display:none;"/>
                                    </div> <!-- end col-lg-6 div -->
                                    <div class="col-lg-6">
                                    <button
                                        class="btn btn-default btn-sm csbtn"
                                        id="exportColorSettingsButton"
                                        onclick="exportColorSettings();">
                                        <span class="glyphicon glyphicon-download-alt"
                                          aria-hidden="true"></span> &nbsp;
                                          Export color settings file
                                    </button>
                                    </div> <!-- end col-lg-6 div -->
                                    </div> <!-- end row div -->
                                    <div class="row">
                                        <div class="col-lg-3">
                                        </div>
                                        <div class="col-lg-6">
                                        <button
                                            class="btn btn-default btn-sm csbtn"
                                            id="resetColorSettingsButton"
                                            onclick="resetColorSettings();">
                                            <span class="glyphicon glyphicon-refresh"
                                              aria-hidden="true"></span> &nbsp;
                                              Reset color settings to defaults
                                        </button>
                                        </div>
                                        <div class="col-lg-3">
                                        </div>
                                    </div>
                                    </div> <!-- end container-fluid div -->
                                    <p>
                                        Color settings can be modified using
                                        the corresponding text boxes or their
                                        corresponding color pickers (accessible
                                        via clicking on the colored square in
                                        the right side of each text box).
                                    </p>
                                    <p>
                                        Colors can be entered in text boxes
                                        as RGB triplets (of the form
                                        <kbd>rgb(r, g, b)</kbd> where
                                        <kbd>r</kbd>,
                                        <kbd>g</kbd>, and
                                        <kbd>b</kbd> are integers in the
                                        range <kbd>[0, 255]</kbd>), <a
                href="https://en.wikipedia.org/wiki/Web_colors#Hex_triplet">hex
                                       triplets</a>, or <a
                href="https://en.wikipedia.org/wiki/Web_colors#X11_color_names"
                                        >HTML color names.</a>
                                    </p>
                                    <p>
                                        Changes to the two extreme colors used
                                        for node colorization (for 0% and 100%)
                                        will also adjust the below gradient
                                        accordingly, to give a preview of the
                                        resulting colorization scheme.
                                    </p>
                                    <!-- Colorpickers for node colorization -->
                                    <!-- Gradient preview -->
                                    <!-- NOTE that these colors should be
                                        updated if the corresponding default
                                        max/min colorization colors are updated
                                    -->
                                    <div
                                        class="gradient_preview nonselectable">
                                        <span id="0gp" style="background-color:
                                        rgb(0, 34, 255);">
                                            &nbsp;&nbsp;&nbsp;&nbsp;</span>
                                        <span id="25gp" style="background-color:
                                        rgb(64, 34, 191);">
                                          &nbsp;&nbsp;&nbsp;&nbsp;</span>
                                        <span id="50gp" style="background-color:
                                        rgb(128, 34, 128);">
                                          &nbsp;&nbsp;&nbsp;&nbsp;</span>
                                        <span id="75gp" style="background-color:
                                        rgb(191, 34, 64);">
                                          &nbsp;&nbsp;&nbsp;&nbsp;</span>
                                        <span id="100gp" style="background-color:
                                        rgb(255, 34, 0);">
                                          &nbsp;&nbsp;&nbsp;&nbsp;</span>
                                    </div>
                                    <!-- NOTE that changes to the defaults here
                                        should be reflected in
                                        DEFAULT_COLOR_SETTINGS in
                                        viewer/index.html
                                    -->
                                    <div class="container-fluid">
                                    <div class="row">
                                    <!-- Left column -->
                                    <div class="col-lg-6">
                                        <label class="cplabel" for="mincncp">
                                            Nodes (colorized: 0%)</label>
                                        <div id="mincncp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#0022ff"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                    </div>
                                    <!-- Right column -->
                                    <div class="col-lg-6">
                                        <label class="cplabel" for="maxcncp">
                                            Nodes (colorized: 100%)</label>
                                        <div id="maxcncp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#ff2200"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                    </div>
                                    </div>
                                    <!-- Colorpickers for labels of colorized
                                        nodes; placed here in order to be
                                        close to other node colorization
                                        colorpickers --> 
                                    <div class="row">
                                    <div class="col-lg-6">
                                        <label class="cplabel" for="cnlcp">
                                            Node labels (colorized)</label>
                                        <div id="cnlcp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#ffffff"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                    </div>
                                    <!-- Right column -->
                                    <div class="col-lg-6">
                                        <label class="cplabel" for="csnlcp">
                                            Node labels (colorized, selected)
                                        </label>
                                        <div id="csnlcp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#ffffff"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                    </div>
                                    </div>
                                    <!-- Colorpickers for non-node-
                                        colorization stuff -->
                                    <div class="row">
                                    <!-- Left column of colorpickers -->
                                    <div class="col-lg-6">
                                        <label class="cplabel" for="usncp">
                                            Nodes (default)</label>
                                        <div id="usncp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#999999"
                                                class="form-control" />
                                            <!-- following <span> is needed to
                                                display the color "preview" -->
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="bubblecp">
                                            Bubbles</label>
                                        <div id="bubblecp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#9abaf3"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="fropecp">
                                            Frayed Ropes</label>
                                        <div id="fropecp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#59f459"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="chaincp">
                                            Chains</label>
                                        <div id="chaincp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#fcaca3"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="ychaincp">
                                            Cyclic Chains</label>
                                        <div id="ychaincp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#ffd163"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="spqrscp">
                                            Series Metanodes</label>
                                        <div id="spqrscp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#FFD644"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="spqrpcp">
                                            Parallel Metanodes</label>
                                        <div id="spqrpcp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#EB8EF9"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="spqrrcp">
                                            Rigid Metanodes</label>
                                        <div id="spqrrcp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#31BF6F"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="bicmpcp">
                                            Bicomponent Nodes</label>
                                        <div id="bicmpcp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#e9e9e9"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="tnbcp">
                                            Finishing Candidate Node borders
                                        </label>
                                        <div id="tnbcp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#000000"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="tngbcp">
                                            Finishing Candidate Node Group
                                            borders
                                        </label>
                                        <div id="tngbcp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#000000"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                    </div>
                                    <!-- Right column of colorpickers -->
                                    <div class="col-lg-6">
                                        <label class="cplabel" for="usnlcp">
                                            Node labels (default)</label>
                                        <div id="usnlcp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#000000"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="snlcp">
                                            Node labels (default, selected)
                                        </label>
                                        <div id="snlcp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#ffffff"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="usecp">
                                            Edges (default)</label>
                                        <div id="usecp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#777777"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="secp">
                                            Edges (default, selected)</label>
                                        <div id="secp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#222222"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="hoecp">
                                            Edges (high outlier)</label>
                                        <div id="hoecp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#ff0000"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="hosecp">
                                            Edges (high outlier, selected)
                                        </label>
                                        <div id="hosecp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#800000"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="loecp">
                                            Edges (low outlier)</label>
                                        <div id="loecp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#0000ff"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="losecp">
                                            Edges (low outlier, selected)
                                        </label>
                                        <div id="losecp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#000080"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="cngcccp">
                                            Node Group "child count" labels
                                        </label>
                                        <div id="cngcccp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#000000"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="sngbcp">
                                            Selected Node Group borders</label>
                                        <div id="sngbcp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#000000"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                        <label class="cplabel" for="bgcp">
                                            Graph background</label>
                                        <div id="bgcp" class="input-group
                                            colorpicker-component">
                                            <input type="text" value="#FFFFFF"
                                                class="form-control" />
                                            <span class="input-group-addon">
                                                <i></i></span>
                                        </div>
                                    </div>
                                    </div> <!-- end row div -->
                                    </div> <!-- end container-fluid div -->
                                </div> <!-- end colortab -->
                            </div> <!-- end tab-content -->
                        </div> <!-- end tab div -->
                    </div>
                    <div class="modal-footer">
                        <!-- TODO: add "reset defaults" button? -->
                        <button type="button" class="btn btn-default"
                            data-dismiss="modal">Close
                        </button>
                    </div>
                </div> <!-- end modal-content div -->
            </div> <!-- end modal-dialog div -->
        </div> <!-- end modal div -->
        <!-- Edge filtering dialog -->
        <div class="modal fade" tabindex="-1" role="dialog"
            id='edgeFilteringDialog'>
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close dialog">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title">Filter edges by weight</h4>
                    </div> <!-- end modal-header div -->
                    <div class="modal-body">
                        <svg id="edgeWeightChart" width="550" height="200">
                        </svg>

                        <!-- NOTE this feature doesn't work very well with
                            collapsing yet -->
                        <div class='input-group input-group-sm'>
                            <span class='input-group-btn'>
                                <button class='btn btn-default disabled'
                                    disabled="disabled" onclick='cullEdges();'
                                    type="button" id="cullEdgesButton">
                                    <span class="glyphicon glyphicon-remove"
                                        aria-hidden="true"></span> &nbsp;
                                    Hide edges below a weight of
                                </button>
                            </span>
                            <input type='text' class='form-control'
                                id="cullEdgesInput" value="0"
                                disabled="disabled">
                        </div>
                    </div> <!-- end modal-body div -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default"
                            data-dismiss="modal">Close
                        </button>
                    </div> <!-- end modal-footer div -->
                </div> <!-- end modal-content div -->
            </div> <!-- end modal-dialog div -->
        </div> <!-- end modal div -->
        <!-- Assembly info dialog -->
        <div class="modal fade" tabindex="-1" role="dialog" id='infoDialog'>
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close dialog">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title">
                            Assembly information
                        </h4>
                    </div> <!-- end modal-header div -->
                    <div class="modal-body">
                        <div class="table-responsive">
                            <table border="2"
                                    class="table table-condensed asmInfoTable">
                                <tr>
                                    <th>Input Filename</th>
                                    <th>Input Filetype</th>
                                    <th id="asmNodeCtTH">
                                        Positive Node Count</th>
                                    <th id="asmEdgeCtTH">
                                        Positive Edge Count</th>
                                </tr>
                                <tr>
                                    <td id="filenameEntry"></td>
                                    <td id="filetypeEntry"></td>
                                    <td id="nodeCtEntry"></td>
                                    <td id="edgeCountEntry"></td>
                                </tr>
                            </table>
                        </div>
                        <div class="table-responsive">
                            <table border="2"
                                    class="table table-condensed asmInfoTable">
                                <tr>
                                    <th>SPQR Decomposition Mode Connected Component Count</th>
                                    <th>Biconnected Component Count</th>
                                    <th>Standard Mode Connected Component Count</th>
                                </tr>
                                <tr>
                                    <td id="sccCountEntry"></td>
                                    <td id="bicmpCountEntry"></td>
                                    <td id="connCmpCtEntry"></td>
                                </tr>
                            </table>
                        </div>
                        <div class="table-responsive">
                            <table border="2"
                                    class="table table-condensed asmInfoTable">
                                <tr>
                                    <th id="asmNodeLenTH">
                                        Total Positive Node Length</th>
                                    <th>N50</th>
                                    <th id="asmGCTH">Assembly GC Content</th>
                                </tr>
                                <tr>
                                    <td id="totalBPLengthEntry"></td>
                                    <td id="n50Entry"></td>
                                    <td id="asmGCEntry"></td>
                                </tr>
                            </table>
                        </div>
                        <p id="currComponentInfo">
                            No connected component has been drawn yet.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default"
                            data-dismiss="modal">Close
                        </button>
                    </div>
                </div> <!-- end modal-content div -->
            </div> <!-- end modal-dialog div -->
        </div> <!-- end modal div -->
    </body>
</html>
