<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="shortcut icon" href="bubble.ico" />
        <meta name="viewport"
            content="width=device-width,initial-scale=1,user-scalable=no" />
        <title>AsmViz Viewer</title>
        <!-- Load external libraries:
             -Cytoscape.js (for drawing the graph)
             -sql.js (for reading SQLite .db files)
             -jQuery (for supporting jQuery UI)
             -jQuery UI (for dialogs, other misc UI features) -->
        <!-- TODO, ensure we use the minimized versions for release -->
        <script src="https://code.jquery.com/jquery-3.1.0.min.js"
            integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s="
            crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js"
            integrity="sha256-eGE6blurk5sHj+rmkfsGYeKyZx3M4bG+ZlFyA7Kns7E="
            crossorigin="anonymous"></script>
        <link rel="stylesheet"
            href="https://code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/viewer_style.css">
        <!-- Initialize some jQuery UI things -->
        <script>
            $(function() {
                $("input[name=rotationRadio]").on("change", changeRotation);
                $(".largeDialog").dialog({autoOpen: false,
                    width: 'auto', height: 'auto'});
                $("#selectedInfoDialog").dialog("option", "buttons",
                    [
                        {
                            html: "Export selected DNA &#8594; FASTA",
                            icons: {
                                primary: "ui-icon-copy"
                            },
                            click: exportSelectedNodeDNA
                        }
                    ]
                );
                $("#selectedInfoDialog").on("dialogclose", clearInfoTables);
                $("#selectedInfoDialog").dialog("option", "resizable", false);
                $(window).on("beforeunload", closeDB);
            });
        </script>
        <script src='js/cytoscape.min.js'></script>
        <script src='js/sql.js'></script>
        <script src='js/xdot2cy.js'></script>
        <script src='js/bootstrap.min.js'></script>
    </head>
    <body>
        <div id="controlsToggler" onclick="toggleControls();">
           <span class="glyphicon glyphicon-menu-hamburger"></span>
        </div>

        <button class='btn btn-default btn-sm disabled'
            onclick='fitGraph(false)' id="fitButton" disabled="disabled">
            <span class="glyphicon glyphicon-resize-full"></span>
        </button>

        <button class='btn btn-default btn-sm disabled'
            onclick='fitGraph(true)' id="fitSelectedButton"
            disabled="disabled">
            <span class="glyphicon glyphicon-resize-small"></span>
        </button>

        <div id="controls" class="viewable">
            <h4>File Selection</h4>
            <p>
            <button class='btn btn-default btn-sm' id="xmlFileselectButton"
                onclick="openFileSelectDialog();">
                <span class="glyphicon glyphicon-repeat"
                    aria-hidden="true"></span> &nbsp; Demo .db
            </button>
            <button class='btn btn-default btn-sm' id="fileselectButton"
                onclick="$('#fileselector').click();">
                <span class="glyphicon glyphicon-folder-open"
                    aria-hidden="true"></span> &nbsp; Choose .db file
            </button>
            <!-- For some reason, giving this the hiddenElement class
                doesn't work; I suspect it's due to the way browsers handle
                styling of file inputs. Anyway, this should work fine. -->
    	    <input type='file' id='fileselector'
                onchange='loadgraphfile();' style="display: none"/>

            <button class='btn btn-default btn-sm disabled'
                disabled="disabled"
                onclick='displayInfo();' id="infoButton">
                <span class="glyphicon glyphicon-info-sign"
                    aria-hidden="true"></span> &nbsp; Assembly info
            </button>
            </p>
            <p>
                <div class="progress">
                    <div class="progress-bar notransitions" role="progressbar"
                         aria-valuenow="0" aria-valuemin="0"
                         aria-valuemax="100" style="width: 0%;">
                        <span class="sr-only"></span>
                    </div>
                </div>
                <div id='textStatus'>&nbsp;</div>
            </p>
            <hr />

            <h4>Connected Components</h4>
    
            <p>
            <!-- Actually use an integer spinner; maybe use something like
                 -[text]+ with fancy -/+ buttons or something. alternatively
                 use a a specialized bootstrap spinner extension, but that
                 seems sort of excessive -->
<!--        <input id='componentselector' value="1"
                title="Enter the size rank of the connected component to
                draw. 1 is the largest component (by number of nodes),
                2 is the second-largest, and so on." /> -->
                <div class='input-group input-group-sm'>
                    <input type='text' class='form-control' type="number"
                        id="componentselector" min="0" value="1" step="1"
                        disabled="disabled">
                    <span class='input-group-btn'>
                        <button class='btn btn-default disabled'
                            disabled="disabled"
                            onclick='startDrawComponent();' type="button"
                            id="drawButton">
                            <span class="glyphicon glyphicon-pencil"
                                aria-hidden="true"></span> &nbsp;
                                Draw connected component
                        </button>
                    </span>
                </div>
            </p>
            <hr /> 

            <h4>Selected Elements</h4>
            <p>
    
            <button class='btn btn-default btn-sm disabled'
                disabled="disabled"
                onclick='displaySelectedInfo();' id="selectedInfoButton">
                <span class="glyphicon glyphicon-list-alt"
                    aria-hidden="true"></span> &nbsp;
                Selected element info
            </button>
            <!-- TODO construct div to hold selected cluster info, selected
                node info, selected edge info; with collapsing caret buttons
                using glyphicons, etc. test it out-->
            </p>
            <hr /> 

            <h4>Search for Elements</h4>
            <p>
            <div class='input-group input-group-sm'>
                <input type='text' class='form-control' 
                    id="searchInput" disabled="disabled"
                                     onkeypress="searchWithEnter(event);">
                <span class='input-group-btn'>
                    <button class='btn btn-default disabled'
                        disabled="disabled"
                        onclick='searchForEles();' type="button"
                        id="searchButton" aria-label="Search">
                        <span class="glyphicon glyphicon-search"
                            aria-hidden="true"></span>
                    </button>
                </span>
            </div>
            </p>
            <hr />
            <h4>Graph View Controls</h4>
            <p>
            <!-- Value of this button will be toggled as all nodes in graph
                 are collapsed/uncollapsed -->
            <button class='btn btn-default btn-sm disabled'
                disabled="disabled"
                id='collapseButton' onclick='startCollapseAll()'>
                <span id="collapseButtonIcon"
                    class="glyphicon glyphicon-minus"></span> &nbsp;
                <span id="collapseButtonText">Collapse All</span>
            </button>
            </p>

            <p>

            <!-- As with other Bootstrap buttons, we need to do two "layers"
                 of disabling. Adding the disabled class to a button makes
                 Bootstrap style the button to look disabled, but the button
                 will still be usable. Adding the disabled="disabled" attribute
                 makes the button actually disabled (i.e. not usable).
            
                 To handle this properly, we use the enableButton and
                 disableButton functions to ensure buttons are always properly
                 disabled/enabled.
            -->
            <div class="btn-group" data-toggle="buttons"
                aria-label="Graph hierarchical rank direction"
                id="rotationButtonGroup">
                <button class="btn btn-default disabled" value="0" id="dir0"
                    disabled="disabled">
                    <input type="radio" name="rotationRadio"
                        autocomplete="off">&#8595;
                </button>
                <button class="btn btn-default active disabled" value="90"
                    id="dir90" disabled="disabled">
                    <input type="radio" name="rotationRadio" checked="checked"
                        autocomplete="off">&#8594;
                </button>
                <button class="btn btn-default disabled" value="180"
                    id="dir180" disabled="disabled">
                    <input type="radio" name="rotationRadio"
                        autocomplete="off">&#8593;
                </button>
                <button class="btn btn-default disabled" value="270"
                    id="dir270" disabled="disabled">
                    <input type="radio" name="rotationRadio"
                        autocomplete="off">&#8592;
                </button>
            </div>
    
            <button class='btn btn-default btn-sm disabled'
                disabled="disabled"
                id='exportButton' onclick='exportGraph()'>
                <span class="glyphicon glyphicon-picture"></span> &nbsp;
                Export view
            </button>
            </p>

            <div id='status'></div>
        </div> <!-- end controls div -->
        <div id="cy" class="nosubsume"></div> <!--container for Cytoscape.js-->
        <div id='fsDialog' title="Select a demo assembly file"
            class="hiddenElement largeDialog">
            <!-- fix weird selection problem -->
            <input autofocus class="hiddenElement" />
            <label for="ecoli.db">E. coli (LastGraph [Velvet], 279 contigs, 332
                edges)</label>
            <input type="radio" name="fs" id="ecoli.db" checked="checked">
            <br />
            <label for="shakya.db">Bacterial/Archaeal Metagenome from 
                <!-- We use target="_blank" to specify to open article in
                    new tab or window (depends on browser) -->
                <a target="_blank"
                href="http://www.ncbi.nlm.nih.gov/pubmed/23387867"><em>Shakya
                    et al.</em> 2013</a> (GML [Bambus 3], 21,950 scaffolds, 23,501 edges)</label>
            <input type="radio" name="fs" id="shakya.db">
            <br />
            <label for="small_ecoli.db">E. coli (GML [Bambus 3], 168
                scaffolds, 478 edges)</label>
            <input type="radio" name="fs" id="small_ecoli.db">
            <br />
            <label for="sample_salmonella.db">Salmonella enterica (LastGraph, 61 contigs, 82 edges)</label>
            <input type="radio" name="fs" id="sample_salmonella.db">
            <br />
            <label for="sample_gfa.db">sample.gfa from <a
                   target="_blank" href="https://github.com/sjackman/assembly-graph/blob/master/sample.gfa">Shaun Jackman</a> (GFA, 6 contigs, 4 edges)</label>
            <input type="radio" name="fs" id="sample_gfa.db">
            <br />
            <label for="loop_gfa.db">loop.gfa from <a
                   target="_blank"
                   href="https://github.com/sjackman/assembly-graph/blob/master/loop.gfa">Shaun Jackman</a> (GFA, 4 contigs, 4 edges)</label>
            <input type="radio" name="fs" id="loop_gfa.db">
            <br />
            <label for="longtest.db">Bogus test data for "long" bubbles/frayed ropes (LastGraph, 36 contigs, 36 edges)</label>
            <input type="radio" name="fs" id="longtest.db">
            <br />
            <button type="button" id="loadDBbutton" onclick="loadajaxDB();">
                Load selected file
            </button>
        </div>
        <div id='infoDialog' title="Assembly Information"
            class="hiddenElement largeDialog">
            <!-- We implement this hidden input with autofocus to fix the
                 issue detailed here: http://stackoverflow.com/a/4814001
                 Not having this input causes the dialog's close button to be
                 automatically selected, which looks strange in this case. -->
            <input autofocus class="hiddenElement" />
            <table border="2" class="centeredInDiv">
                <tr>
                    <th>Filename</th>
                    <th>Filetype</th>
                    <th>Node Count</th>
                    <th>Total Node Length</th>
                    <th>Edge Count</th>
                    <th>Connected Component Count</th>
                    <th>N50</th>
                    <th>Assembly G/C Content</th>
                </tr>
                <tr>
                    <td id="filenameEntry"></td>
                    <td id="filetypeEntry"></td>
                    <td id="nodeCtEntry"></td>
                    <td id="totalBPLengthEntry"></td>
                    <td id="edgeCountEntry"></td>
                    <td id="connCmpCtEntry"></td>
                    <td id="n50Entry"></td>
                    <td id="asmGCEntry"></td>
                </tr>
            </table>
            <p id="currComponentInfo">No connected component has been
                drawn yet.</p>
            <h3>For contig assembly graphs (LastGraph, GFA)</h3>
            <p>The <strong>node count</strong> and <strong>edge count</strong>
            fields in the table above (not in the percentage statistics)
            only include "positive" contigs and their edges from the assembly
            graph.
            If you would like to know these statistics with negative nodes
            included, then you can just multiply these fields by two.</p>
            <h3>For scaffold assembly graphs (GML)</h3>
            <p>All nodes are included in
            these statistics regardless of orientation.</p>
        </div>
        <div id='selectedInfoDialog' title="Selected element information"
            class="hiddenElement largeDialog">
            <input autofocus class="hiddenElement" />
            <table border="2" id="nodeInfoTable" class="centeredInDiv">
            </table>
            <table border="2" id="edgeInfoTable" class="centeredInDiv">
            </table>
            <table border="2" id="clusterInfoTable" class="centeredInDiv">
            </table>
        </div>
    </body>
</html>
